<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZoomUnta</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f0f2f5;
}

/* HEADER */
header {
    background: #1877f2;
    color: white;
    padding: 12px;
    font-size: 22px;
    font-weight: bold;
    text-align: center;
}

/* POST BOX */
.post-box {
    background: white;
    padding: 12px;
    margin: 10px;
    border-radius: 8px;
}

.post-box input,
.post-box textarea {
    width: 100%;
    margin-bottom: 8px;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
}

.post-box button {
    background: #1877f2;
    color: white;
    border: none;
    padding: 10px;
    width: 100%;
    border-radius: 6px;
    font-size: 16px;
}

/* FEED */
.feed {
    margin: 10px;
}

.post {
    background: white;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 10px;
}

.post h4 {
    margin: 0;
}

.post p {
    margin-top: 6px;
}

.post img {
    max-width: 100%;
    border-radius: 6px;
    margin-top: 6px;
}

audio {
    margin-top: 6px;
    width: 100%;
}
</style>
</head>

<body>

<header>ZoomUnta</header>

<div class="post-box">
    <input type="text" id="name" placeholder="Your name">
    <textarea id="message" placeholder="What's on your mind?"></textarea>
    <input type="file" id="image" accept="image/*">
    <input type="file" id="audio" accept="audio/*">
    <button onclick="addPost()">Post</button>
</div>

<div class="feed" id="feed"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-storage.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyBQXx4AgjmjFhWTQEGZFJ8gyjhrGG36T04",
    authDomain: "zoomunta.firebaseapp.com",
    projectId: "zoomunta",
    databaseURL: "https://zoomunta-default-rtdb.firebaseio.com",
    storageBucket: "zoomunta.appspot.com",
    messagingSenderId: "490604667032",
    appId: "1:490604667032:web:088173f78346086d14f0ed"
};
const app = firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const storage = firebase.storage();

// References
const feedRef = database.ref('posts');
const adminRef = database.ref('adminMessages');

// Display posts in real-time
feedRef.on('value', snapshot => {
    const feed = document.getElementById("feed");
    feed.innerHTML = "";
    const data = snapshot.val();
    if (data) {
        const postsArray = Object.values(data).reverse();
        postsArray.forEach(post => {
            feed.innerHTML += `
                <div class="post">
                    <h4>${post.name}</h4>
                    <p>${post.message}</p>
                    ${post.imageURL ? `<img src="${post.imageURL}" alt="Image">` : ""}
                    ${post.audioURL ? `<audio controls src="${post.audioURL}"></audio>` : ""}
                </div>
            `;
        });
    }
});

// Add new post
async function addPost() {
    const name = document.getElementById("name").value.trim();
    const message = document.getElementById("message").value.trim();
    const imageFile = document.getElementById("image").files[0];
    const audioFile = document.getElementById("audio").files[0];

    if (!name || !message) {
        alert("Please enter name and message");
        return;
    }

    // Upload image if exists
    let imageURL = "";
    if (imageFile) {
        const imageRef = storage.ref().child('images/' + Date.now() + '_' + imageFile.name);
        await imageRef.put(imageFile);
        imageURL = await imageRef.getDownloadURL();
    }

    // Upload audio if exists
    let audioURL = "";
    if (audioFile) {
        const audioRef = storage.ref().child('audio/' + Date.now() + '_' + audioFile.name);
        await audioRef.put(audioFile);
        audioURL = await audioRef.getDownloadURL();
    }

    // Push to public feed
    feedRef.push({ name, message, imageURL, audioURL });

    // Push to admin inbox
    adminRef.push({ name, message, imageURL, audioURL, timestamp: Date.now() });

    // Clear inputs
    document.getElementById("name").value = "";
    document.getElementById("message").value = "";
    document.getElementById("image").value = "";
    document.getElementById("audio").value = "";
}
</script>

</body>
</html>
