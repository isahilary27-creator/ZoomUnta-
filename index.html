<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZoomUnta</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body { font-family: Arial; background:#f0f2f5; margin:0; }
header { background:#1877f2; color:white; padding:12px; text-align:center; font-size:22px; }
.box { background:white; padding:12px; margin:10px; border-radius:8px; }
input, textarea, button { width:100%; margin-top:6px; padding:8px; }
button { background:#1877f2; color:white; border:none; border-radius:6px; }
.post { background:white; padding:10px; margin:10px; border-radius:8px; }
.post img, .post video { max-width:100%; margin-top:6px; }
</style>
</head>

<body>

<header>Zoom<span style="color:orange;">Unta</span></header>

<div class="box" id="profileBox">
  <h3>Create Profile</h3>
  <input id="profileName" placeholder="Your name">
  <button onclick="createProfile()">Create Profile</button>
</div>

<div class="box" id="postBox" style="display:none;">
  <input id="postName" readonly>
  <textarea id="postText" placeholder="What's on your mind?"></textarea>
  <input type="file" id="postImage" accept="image/*">
  <input type="file" id="postVideo" accept="video/*">
  <button onclick="addPost()">Post</button>
</div>

<div id="feed"></div>

<script>
const supabase = window.supabase.createClient(
  "https://krawfxijpbqgdsotyipf.supabase.co",
  "sb_publishable_J6McZSVzeoAcMXnP8iys0A_0xIf0fUP"
);

let profile = JSON.parse(localStorage.getItem("zoomunta_profile"));

if(profile) showApp();

async function createProfile(){
  const name = document.getElementById("profileName").value.trim();
  if(!name) return alert("Enter your name");

  const { data, error } = await supabase
    .from("profiles")
    .insert({ name })
    .select()
    .single();

  if(error) return alert(error.message);

  localStorage.setItem("zoomunta_profile", JSON.stringify(data));
  profile = data;
  showApp();
}

function showApp(){
  document.getElementById("profileBox").style.display="none";
  document.getElementById("postBox").style.display="block";
  document.getElementById("postName").value = profile.name;
  loadPosts();
}

async function addPost(){
  const text = document.getElementById("postText").value;
  const image = document.getElementById("postImage").files[0];
  const video = document.getElementById("postVideo").files[0];

  let image_url=null, video_url=null;

  if(image) image_url = await toBase64(image);
  if(video) video_url = await toBase64(video);

  await supabase.from("posts").insert({
    profile_id: profile.id,
    message: text,
    image_url,
    video_url
  });

  document.getElementById("postText").value="";
  document.getElementById("postImage").value="";
  document.getElementById("postVideo").value="";
  loadPosts();
}

async function loadPosts(){
  const { data } = await supabase
    .from("posts")
    .select("message,image_url,video_url,created_at")
    .order("created_at",{ascending:false});

  const feed = document.getElementById("feed");
  feed.innerHTML="";

  data.forEach(p=>{
    feed.innerHTML += `
      <div class="post">
        ${p.message?`<p>${p.message}</p>`:""}
        ${p.image_url?`<img src="${p.image_url}">`:""}
        ${p.video_url?`<video controls src="${p.video_url}"></video>`:""}
      </div>`;
  });
}

function toBase64(file){
  return new Promise(res=>{
    const r=new FileReader();
    r.onload=()=>res(r.result);
    r.readAsDataURL(file);
  });
}
</script>

</body>
</html>
